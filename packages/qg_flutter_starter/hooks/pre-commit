#!/usr/bin/env bash
printf "\e[33;1m%s\e[0m\n" 'Stashing changes if any ...'
git stash -q --keep-index

printf "\e[33;1m%s\e[0m\n" 'Running the Flutter formatter ...'
flutter format .

printf "\e[33;1m%s\e[0m\n" 'Running the Flutter analyzer ...'
flutter analyze


if [ $? -ne 0 ]; then
        printf "\e[33;1m%s\e[0m\n" 'ERROR WHILE ANALYZING => Popping stash'
        git stash pop -q
        exit 1
fi

printf "\e[33;1m%s\e[0m\n" 'Running tests ...'
flutter test


if [ $? -ne 0 ]; then
        printf "\e[33;1m%s\e[0m\n" 'ERROR WHILE TESTING => Popping stash'
        git stash pop -q
        exit 1
fi

printf "\e[33;1m%s\e[0m\n" 'SUCCESS!'
git stash pop -q
exit 0

